/*!
 * @package Leniwiec.js
 * @version v2.0.0
 * @author Przemysław Tyczyński | https://tyczynski.pl
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Leniwiec=t()}(this,function(){"use strict";var e=(e,...t)=>{if("function"==typeof e)return e(...t)};const t={root:null,rootMargin:"0px",threshold:0,errorClassName:"is-error",loadedClassName:"is-loaded",onLoad:null,onError:null};class s{constructor(e,r={}){this.elements=s.getElements(e),this.config=Object.assign({},t,r),this.observer=this.createObserver(),("undefined"!=typeof window&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent))&&this.loadAll()}createObserver(){const{root:e,rootMargin:t,threshold:s}=this.config,r=new IntersectionObserver(this.callback.bind(this),{root:e,rootMargin:t,threshold:s});for(let e of this.elements)r.observe(e);return r}callback(e){e.forEach(e=>{const{target:t}=e;e.isIntersecting&&this.loadAndUnobserve(t)})}loadAndUnobserve(e){this.load(e),this.observer.unobserve(e)}load(e){const t=this.getTargetAttributes(e);e.hasAttribute("data-load-image")?this.loadImg(e,t,[t.src]):"IMG"===e.tagName?this.setImg(e,t):"PICTURE"===e.tagName?this.setPicture(e,t):this.setBackgroundImage(e,t)}loadImg(e,t,s){const{src:r}=t,o=new Image;this.bindTargetCallbacks(o,e,s),o.setAttribute("src",r)}setImg(e,t){const{src:s}=t;this.bindTargetCallbacks(e,e),e.setAttribute("src",s)}setBackgroundImage(e,t){const{src:s}=t,r=new Image;this.bindTargetCallbacks(r,e),r.setAttribute("src",s),e.style.backgroundImage=`url(${s})`}setPicture(e,t){const{src:s,alt:r}=t,o=new Image;this.bindTargetCallbacks(o,e),o.setAttribute("src",s),o.setAttribute("alt",r),e.appendChild(o)}getTargetAttributes(e){const t=e.dataset.src||e.dataset.backgroundImage||e.dataset.loadImage||"",{alt:s=""}=e.dataset;return{src:t,alt:s}}bindTargetCallbacks(t,s,r=[]){const{loadedClassName:o,errorClassName:n}=this.config;t.addEventListener("load",()=>{s.classList.add(o),e(this.config.onLoad,s,...r)}),t.addEventListener("error",()=>{s.classList.add(n),e(this.config.onError,s,...r)})}loadAll(){for(let e of this.elements)this.loadAndUnobserve(e)}observe(e){this.observer.observe(e)}unmount(){this.observer.disconnect()}static getElements(e){if("string"==typeof e)return Array.from(document.querySelectorAll(e));if(e instanceof NodeList)return Array.from(e);if(e instanceof HTMLElement)return[e];if(e instanceof Array)return e;throw new Error("Passed elements should be a string selector, NodeList, HTMLElement, Node, HTMLElement[] or Node[]")}}return s});
